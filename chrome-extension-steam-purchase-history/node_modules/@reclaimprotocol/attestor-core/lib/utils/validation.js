"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.assertValidateProviderParams = assertValidateProviderParams;
const ajv_1 = __importDefault(require("ajv"));
const providers_gen_1 = require("../types/providers.gen");
const error_1 = require("../utils/error");
const PROVIDER_VALIDATOR_MAP = {};
const AJV = new ajv_1.default({
    allErrors: true,
    strict: true,
    strictRequired: false,
    formats: {
        binary(data) {
            return data instanceof Uint8Array
                || (typeof Buffer !== 'undefined'
                    && Buffer.isBuffer(data));
        },
        url(data) {
            try {
                new URL(data);
                return true;
            }
            catch (_a) {
                return false;
            }
        }
    }
});
function assertValidateProviderParams(name, params) {
    var _a;
    let validate = PROVIDER_VALIDATOR_MAP[name];
    if (!validate) {
        const schema = (_a = providers_gen_1.PROVIDER_SCHEMAS[name]) === null || _a === void 0 ? void 0 : _a.parameters;
        if (!schema) {
            throw new error_1.AttestorError('ERROR_BAD_REQUEST', `Invalid provider name "${name}"`);
        }
        validate = AJV.compile(schema);
    }
    if (!validate(params)) {
        throw new error_1.AttestorError('ERROR_BAD_REQUEST', 'Params validation failed', { errors: JSON.stringify(validate.errors) });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmFsaWRhdGlvbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy92YWxpZGF0aW9uLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7O0FBOEJBLG9FQXdCQztBQXRERCw4Q0FBMkM7QUFFM0MsMkRBQTBEO0FBQzFELDJDQUErQztBQUUvQyxNQUFNLHNCQUFzQixHQUErQyxFQUFFLENBQUE7QUFFN0UsTUFBTSxHQUFHLEdBQUcsSUFBSSxhQUFHLENBQUM7SUFDbkIsU0FBUyxFQUFFLElBQUk7SUFDZixNQUFNLEVBQUUsSUFBSTtJQUNaLGNBQWMsRUFBRSxLQUFLO0lBQ3JCLE9BQU8sRUFBRTtRQUNSLE1BQU0sQ0FBQyxJQUFhO1lBQ25CLE9BQU8sSUFBSSxZQUFZLFVBQVU7bUJBQzdCLENBQ0YsT0FBTyxNQUFNLEtBQUssV0FBVzt1QkFDMUIsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FDeEIsQ0FBQTtRQUNILENBQUM7UUFDRCxHQUFHLENBQUMsSUFBYTtZQUNoQixJQUFJLENBQUM7Z0JBQ0osSUFBSSxHQUFHLENBQUMsSUFBYyxDQUFDLENBQUE7Z0JBQ3ZCLE9BQU8sSUFBSSxDQUFBO1lBQ1osQ0FBQztZQUFDLFdBQUssQ0FBQztnQkFDUCxPQUFPLEtBQUssQ0FBQTtZQUNiLENBQUM7UUFDRixDQUFDO0tBQ0Q7Q0FDRCxDQUFDLENBQUE7QUFFRixTQUFnQiw0QkFBNEIsQ0FDM0MsSUFBTyxFQUNQLE1BQWU7O0lBRWYsSUFBSSxRQUFRLEdBQUcsc0JBQXNCLENBQUMsSUFBSSxDQUFDLENBQUE7SUFDM0MsSUFBRyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQ2QsTUFBTSxNQUFNLEdBQUcsTUFBQSxnQ0FBZ0IsQ0FBQyxJQUFJLENBQUMsMENBQUUsVUFBVSxDQUFBO1FBQ2pELElBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQztZQUNaLE1BQU0sSUFBSSxxQkFBYSxDQUN0QixtQkFBbUIsRUFDbkIsMEJBQTBCLElBQUksR0FBRyxDQUNqQyxDQUFBO1FBQ0YsQ0FBQztRQUVELFFBQVEsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFBO0lBQy9CLENBQUM7SUFFRCxJQUFHLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7UUFDdEIsTUFBTSxJQUFJLHFCQUFhLENBQ3RCLG1CQUFtQixFQUNuQiwwQkFBMEIsRUFDMUIsRUFBRSxNQUFNLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FDM0MsQ0FBQTtJQUNGLENBQUM7QUFDRixDQUFDIn0=