"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.toprf = void 0;
const ethers_1 = require("ethers");
const utils_1 = require("../../utils");
const env_1 = require("../../utils/env");
const toprf = async ({ maskedData, engine }, { logger }) => {
    const PRIVATE_KEY_STR = (0, env_1.getEnvVariable)('TOPRF_SHARE_PRIVATE_KEY');
    const PUBLIC_KEY_STR = (0, env_1.getEnvVariable)('TOPRF_SHARE_PUBLIC_KEY');
    if (!PRIVATE_KEY_STR || !PUBLIC_KEY_STR) {
        throw new Error('private/public keys not set. Cannot execute OPRF');
    }
    const PRIVATE_KEY = ethers_1.ethers.utils.arrayify(PRIVATE_KEY_STR);
    const PUBLIC_KEY = ethers_1.ethers.utils.arrayify(PUBLIC_KEY_STR);
    const engineStr = (0, utils_1.getEngineString)(engine);
    const operator = (0, utils_1.makeDefaultOPRFOperator)('chacha20', engineStr, logger);
    const res = await operator.evaluateOPRF(PRIVATE_KEY, maskedData);
    return { ...res, publicKeyShare: PUBLIC_KEY };
};
exports.toprf = toprf;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidG9wcmYuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvc2VydmVyL2hhbmRsZXJzL3RvcHJmLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLG1DQUErQjtBQUUvQixxQ0FBb0U7QUFDcEUsdUNBQThDO0FBRXZDLE1BQU0sS0FBSyxHQUF3QixLQUFLLEVBQzlDLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxFQUN0QixFQUFFLE1BQU0sRUFBRSxFQUNULEVBQUU7SUFDSCxNQUFNLGVBQWUsR0FBRyxJQUFBLG9CQUFjLEVBQUMseUJBQXlCLENBQUMsQ0FBQTtJQUNqRSxNQUFNLGNBQWMsR0FBRyxJQUFBLG9CQUFjLEVBQUMsd0JBQXdCLENBQUMsQ0FBQTtJQUMvRCxJQUFHLENBQUMsZUFBZSxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDeEMsTUFBTSxJQUFJLEtBQUssQ0FBQyxrREFBa0QsQ0FBQyxDQUFBO0lBQ3BFLENBQUM7SUFFRCxNQUFNLFdBQVcsR0FBRyxlQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsQ0FBQTtJQUMxRCxNQUFNLFVBQVUsR0FBRyxlQUFNLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxjQUFjLENBQUMsQ0FBQTtJQUV4RCxNQUFNLFNBQVMsR0FBRyxJQUFBLHVCQUFlLEVBQUMsTUFBTSxDQUFDLENBQUE7SUFDekMsTUFBTSxRQUFRLEdBQUcsSUFBQSwrQkFBdUIsRUFBQyxVQUFVLEVBQUUsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFBO0lBQ3ZFLE1BQU0sR0FBRyxHQUFHLE1BQU0sUUFBUSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsVUFBVSxDQUFDLENBQUE7SUFFaEUsT0FBTyxFQUFFLEdBQUcsR0FBRyxFQUFFLGNBQWMsRUFBRSxVQUFVLEVBQUUsQ0FBQTtBQUM5QyxDQUFDLENBQUE7QUFsQlksUUFBQSxLQUFLLFNBa0JqQiJ9