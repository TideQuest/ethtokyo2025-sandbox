"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseRsaPublicKeyFromAsn1 = void 0;
const asn1_cms_1 = require("@peculiar/asn1-cms");
const asn1_rsa_1 = require("@peculiar/asn1-rsa");
const asn1_schema_1 = require("@peculiar/asn1-schema");
function parseRsaPublicKeyFromAsn1(asn1) {
    const parsed = asn1_schema_1.AsnParser.parse(asn1, asn1_cms_1.OriginatorPublicKey);
    const rsaPubKey = asn1_schema_1.AsnParser.parse(parsed.publicKey, asn1_rsa_1.RSAPublicKey);
    return {
        e: bufToBigint(toUint8Array(rsaPubKey.publicExponent)),
        n: bufToBigint(toUint8Array(rsaPubKey.modulus)),
    };
}
exports.parseRsaPublicKeyFromAsn1 = parseRsaPublicKeyFromAsn1;
function toUint8Array(buf) {
    if (buf instanceof Uint8Array) {
        return buf;
    }
    return new Uint8Array(buf);
}
const BITS = 8n;
function bufToBigint(buf) {
    let ret = 0n;
    for (const i of buf.values()) {
        const bi = BigInt(i);
        ret = (ret << BITS) + bi;
    }
    return ret;
}
